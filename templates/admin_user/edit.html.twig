{% extends 'dashboard/base_dashboard.html.twig' %}

{% block body %}

<h2>‚úèÔ∏è Modifier {{ user.nom }} {{ user.prenom }}</h2>

<a href="{{ path('admin_user_index') }}">‚Üê Retour liste</a>

<form method="post" enctype="multipart/form-data" style="margin-top:20px; display:flex; flex-direction:column; gap:15px; max-width:500px;">
    <div>
        <label>Nom</label>
        <input type="text" name="nom" value="{{ user.nom }}" required style="width:100%; padding:8px; border-radius:8px; border:1px solid #ddd;">
    </div>
    <div>
        <label>Pr√©nom</label>
        <input type="text" name="prenom" value="{{ user.prenom }}" required style="width:100%; padding:8px; border-radius:8px; border:1px solid #ddd;">
    </div>
    <div>
        <label>Email</label>
        <input type="email" name="email" value="{{ user.email }}" required style="width:100%; padding:8px; border-radius:8px; border:1px solid #ddd;">
    </div>
    <div>
        <label>T√©l√©phone</label>
        <input type="text" name="tel" value="{{ user.tel }}" required style="width:100%; padding:8px; border-radius:8px; border:1px solid #ddd;">
    </div>
    <div>
        <label>Adresse</label>
        <input type="text" name="adresse" value="{{ user.adresse }}" required style="width:100%; padding:8px; border-radius:8px; border:1px solid #ddd;">
    </div>
    <div>
        <label>R√¥le</label>
        <select name="role" style="width:100%; padding:8px; border-radius:8px; border:1px solid #ddd;">
            <option value="ROLE_PATIENT" {{ 'ROLE_PATIENT' in user.roles ? 'selected' : '' }}>Patient</option>
            <option value="ROLE_MEDECIN" {{ 'ROLE_MEDECIN' in user.roles ? 'selected' : '' }}>M√©decin</option>
            <option value="ROLE_ADMIN" {{ 'ROLE_ADMIN' in user.roles ? 'selected' : '' }}>Admin</option>
        </select>
    </div>
    {# Section dossier m√©dical si patient #}
<div id="dossierMedical" style="border:2px solid #2F60F5; border-radius:12px; padding:15px; display:none;">
    <h3 style="color:#2F60F5; margin-top:0;">üìã Dossier M√©dical</h3>

    <div style="margin-bottom:10px;">
        <label>Groupe Sanguin</label>
        <select name="groupeSanguin" style="width:100%; padding:8px; border-radius:8px; border:1px solid #ddd;">
            {% for gs in ['A+','A-','B+','B-','AB+','AB-','O+','O-'] %}
                <option value="{{ gs }}" {{ user.dossierMedical and user.dossierMedical.groupeSanguin == gs ? 'selected' : '' }}>{{ gs }}</option>
            {% endfor %}
        </select>
    </div>
    <div style="margin-bottom:10px;">
        <label>Ant√©c√©dents</label>
        <textarea name="antecedents" style="width:100%; padding:8px; border-radius:8px; border:1px solid #ddd; height:80px;">{{ user.dossierMedical ? user.dossierMedical.antecedents : '' }}</textarea>
    </div>
    <div style="margin-bottom:10px;">
        <label>Allergies</label>
        <textarea name="allergies" style="width:100%; padding:8px; border-radius:8px; border:1px solid #ddd; height:60px;">{{ user.dossierMedical ? user.dossierMedical.allergies : '' }}</textarea>
    </div>
    <div style="margin-bottom:10px;">
        <label>Poids (kg)</label>
        <input type="number" step="0.1" name="poids" value="{{ user.dossierMedical ? user.dossierMedical.poids : '' }}" style="width:100%; padding:8px; border-radius:8px; border:1px solid #ddd;">
    </div>
    <div style="margin-bottom:10px;">
        <label>Taille (cm)</label>
        <input type="number" name="taille" value="{{ user.dossierMedical ? user.dossierMedical.taille : '' }}" style="width:100%; padding:8px; border-radius:8px; border:1px solid #ddd;">
    </div>
    <div style="margin-bottom:10px;">
        <label>Tension Systolique (mmHg)</label>
        <input type="number" name="tensionSystolique" value="{{ user.dossierMedical ? user.dossierMedical.tensionSystolique : '' }}" style="width:100%; padding:8px; border-radius:8px; border:1px solid #ddd;">
    </div>
    <div style="margin-bottom:10px;">
        <label>Tension Diastolique (mmHg)</label>
        <input type="number" name="tensionDiastolique" value="{{ user.dossierMedical ? user.dossierMedical.tensionDiastolique : '' }}" style="width:100%; padding:8px; border-radius:8px; border:1px solid #ddd;">
    </div>
    <div>
        <label>Fr√©quence Cardiaque (bpm)</label>
        <input type="number" name="frequenceCardiaque" value="{{ user.dossierMedical ? user.dossierMedical.frequenceCardiaque : '' }}" style="width:100%; padding:8px; border-radius:8px; border:1px solid #ddd;">
    </div>
</div>

<script>
function toggleDossier() {
    var role = document.getElementById('roleSelect').value;
    var dossier = document.getElementById('dossierMedical');
    dossier.style.display = role === 'ROLE_PATIENT' ? 'block' : 'none';
}

// Ajoute id au select r√¥le
document.querySelector('select[name="role"]').id = 'roleSelect';
toggleDossier();
document.getElementById('roleSelect').addEventListener('change', toggleDossier);
</script>
    <div>
        <label>Nouveau mot de passe <small>(laisser vide pour ne pas changer)</small></label>
        <input type="password" name="password" style="width:100%; padding:8px; border-radius:8px; border:1px solid #ddd;">
    </div>
    <div>
        <label>Photo de profil (optionnel)</label>
        {% if user.imageUrl %}
            <img src="{{ user.imageUrl }}" style="width:60px; height:60px; border-radius:50%; object-fit:cover; margin-bottom:10px; display:block;">
        {% else %}
            <div style="width:60px; height:60px; border-radius:50%; background:linear-gradient(135deg,#F82239,#2F60F5); display:flex; align-items:center; justify-content:center; color:#fff; font-size:24px; font-weight:800; margin-bottom:10px;">
                {{ user.nom|first }}
            </div>
        {% endif %}
        <input type="file" name="imageFile" accept="image/*" style="width:100%; padding:8px; border-radius:8px; border:1px solid #ddd;">
    </div>
    <button type="submit" style="background:linear-gradient(90deg,#F82239,#2F60F5); color:#fff; border:none; padding:12px; border-radius:12px; font-weight:800; cursor:pointer;">
        Modifier
    </button>
</form>

{% endblock %}