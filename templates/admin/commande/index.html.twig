<h1>Admin - Commandes</h1>

{% for label, msgs in app.flashes %}
  {% for m in msgs %}
    <div style="padding:10px; margin:10px 0; border:1px solid #ccc;">
      <b>{{ label }}</b> â€” {{ m }}
    </div>
  {% endfor %}
{% endfor %}

<table border="1" cellpadding="8" cellspacing="0" style="width:100%; border-collapse:collapse;">
  <thead>
  <tr>
    <th>ID</th><th>Patient</th><th>Date</th><th>Statut</th><th>Total</th><th>Actions</th>
  </tr>
  </thead>
  <tbody>
  {% for c in commandes %}
    <tr>
      <td>{{ c.id }}</td>
      <td>{{ c.user.email }}</td>
      <td>{{ c.dateCommande ? (c.dateCommande|date('Y-m-d H:i')) : '-' }}</td>
      <td>{{ c.statut }}</td>
      <td>{{ c.montantTotal }}</td>
      <td style="display:flex; gap:8px;">

        {% if c.statut == 'EN_ATTENTE_PAIEMENT' %}
          <form method="post" action="{{ path('admin_commande_pay', {id: c.id}) }}">
            <input type="hidden" name="_token" value="{{ csrf_token('admin_pay_' ~ c.id) }}">
            <button type="submit">Marquer PAYEE</button>
          </form>
        {% endif %}

        {% if c.statut == 'PAYEE' %}
          <form method="post" action="{{ path('admin_commande_deliver', {id: c.id}) }}">
            <input type="hidden" name="_token" value="{{ csrf_token('admin_deliver_' ~ c.id) }}">
            <button type="submit">Marquer LIVREE</button>
          </form>
        {% endif %}

      </td>
    </tr>
  {% else %}
    <tr><td colspan="6">Aucune commande.</td></tr>
  {% endfor %}
  </tbody>
</table>
