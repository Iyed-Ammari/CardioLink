{% extends 'dashboard/base_dashboard.html.twig' %}

{% block body %}

<h2>ğŸ“‹ Dossiers MÃ©dicaux</h2>

{# Filtre par groupe sanguin #}
<form method="get" style="margin-bottom:20px;">
    <select name="groupeSanguin" onchange="this.form.submit()" style="padding:8px; border-radius:8px; border:1px solid #ddd;">
        <option value="">ğŸ©¸ Tous les groupes sanguins</option>
        {% for gs in ['A+','A-','B+','B-','AB+','AB-','O+','O-'] %}
            <option value="{{ gs }}" {{ groupeSanguin == gs ? 'selected' : '' }}>{{ gs }}</option>
        {% endfor %}
    </select>
</form>

<table border="1">
    <tr>
        <th>Patient</th>
        <th>Groupe Sanguin</th>
        <th>IMC</th>
        <th>Risque Cardiaque</th>
        <th>Actions</th>
    </tr>
    {% for dossier in dossiers %}
    <tr>
        <td>{{ dossier.user.nom }} {{ dossier.user.prenom }}</td>
        <td>{{ dossier.groupeSanguin }}</td>
        <td>{{ dossier.IMC ?? '-' }}</td>
        <td>
            {% set risque = dossier.risqueCardiaque %}
            {% if risque == 'CRITIQUE' %}
                <span style="color:red;">ğŸ”´ CRITIQUE</span>
            {% elseif risque == 'Ã‰LEVÃ‰' %}
                <span style="color:orange;">ğŸŸ  Ã‰LEVÃ‰</span>
            {% elseif risque == 'MODÃ‰RÃ‰' %}
                <span style="color:#ca8a04;">ğŸŸ¡ MODÃ‰RÃ‰</span>
            {% else %}
                <span style="color:green;">ğŸŸ¢ NORMAL</span>
            {% endif %}
        </td>
        <td>
            <a href="{{ path('admin_dossier_show', {id: dossier.id}) }}">ğŸ‘ï¸ Voir</a>
            &nbsp;
            <a href="{{ path('admin_dossier_edit', {id: dossier.id}) }}">âœï¸ Modifier</a>
            &nbsp;
            <form method="post" action="{{ path('admin_dossier_delete', {id: dossier.id}) }}" style="display:inline;" onsubmit="return confirm('Supprimer ce dossier ?')">
                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ dossier.id) }}">
                <button type="submit" style="color:red; background:none; border:none; cursor:pointer;">ğŸ—‘ï¸ Supprimer</button>
            </form>
        </td>
    </tr>
    {% else %}
    <tr><td colspan="5">Aucun dossier mÃ©dical.</td></tr>
    {% endfor %}
</table>

{% endblock %}