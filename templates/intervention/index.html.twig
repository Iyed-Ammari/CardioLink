{# templates/intervention/index.html.twig #}

{% extends 'base.html.twig' %}

{% block title %}Interventions{% endblock %}

{% block body %}
<div class="container-fluid mt-5 px-5">
    <h1 class="mb-4" style="font-size: 2.5rem; font-weight: bold;">
        <i class="fas fa-ambulance"></i> Interventions
    </h1>

    <div class="mb-5">
        <a href="{{ path('app_intervention_urgent') }}" class="btn text-white shadow" style="background: #d83a56; border-radius: 12px; padding: 15px 30px; font-weight: 600; border: none; font-size: 1.1rem;">
            <i class="fas fa-exclamation-triangle"></i> Alertes SOS Urgentes
        </a>
    </div>

    {# Barre de Recherche Agrandie #}
    <form method="get" class="mb-5">
        <div class="input-group" style="box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
            <input type="text" name="search" class="form-control" 
                   placeholder="Rechercher une intervention (Type, description...)" 
                   style="border-radius: 12px; border: 1px solid #eee; padding: 20px; font-size: 1.15rem;"
                   value="{{ current_search }}">
        </div>
        <button class="btn mt-3 text-white shadow" type="submit" style="background: linear-gradient(to right, #d83a56, #516be1); border-radius: 10px; padding: 12px 45px; font-size: 1.1rem; border: none; font-weight: 600;">
            Rechercher
        </button>
        {% if current_search %}
            <a href="{{ path('app_intervention_index') }}" class="btn btn-link text-decoration-none text-muted ms-3" style="font-size: 1.1rem;">‚úñ Effacer la recherche</a>
        {% endif %}
    </form>

    {% if interventions|length > 0 %}
        <div class="table-responsive">
            <table class="table table-borderless align-middle" style="font-size: 1.2rem;">
                <thead>
                    <tr style="border-bottom: 3px solid #f1f1f1; color: #444;">
                        <th class="py-4 px-3" style="width: 15%;">Type</th>
                        <th class="py-4 px-3" style="width: 30%;">Description</th>
                        <th class="py-4 px-3 text-center" style="width: 20%;">
                            <div style="margin-bottom: 8px; font-weight: 700;">Date planifi√©e</div>
                            <div class="d-flex justify-content-center gap-4">
                                <a href="{{ path('app_intervention_index', {direction: 'ASC', search: current_search}) }}" 
                                   class="text-decoration-none {{ current_direction == 'ASC' ? 'text-primary' : 'text-muted' }}" style="font-size: 1.6rem;">
                                    ‚Üë
                                </a>
                                <a href="{{ path('app_intervention_index', {direction: 'DESC', search: current_search}) }}" 
                                   class="text-decoration-none {{ current_direction == 'DESC' ? 'text-primary' : 'text-muted' }}" style="font-size: 1.6rem;">
                                    ‚Üì
                                </a>
                            </div>
                        </th>
                        <th class="py-4 px-3">Statut</th>
                        <th class="py-4 px-3">M√©decin</th>
                        <th class="py-4 px-3 text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for intervention in interventions %}
                        <tr style="border-bottom: 1px solid #f8f8f8; transition: all 0.2s; {{ intervention.isUrgent() ? 'background-color: #fffafa;' : '' }}">
                            <td class="py-4 px-3">
                                <strong style="color: #000;">{{ intervention.type }}</strong>
                                {% if intervention.isUrgent() %}
                                    <br><span class="badge bg-danger mt-1" style="font-size: 0.75rem; padding: 5px 10px;">URGENT</span>
                                {% endif %}
                            </td>
                            <td class="py-4 px-3 text-muted" style="line-height: 1.5;">
                                {{ intervention.description }}
                            </td>
                            <td class="py-4 px-3 text-center">
                                <span class="text-secondary">{{ intervention.datePlanifiee|date('d/m/Y') }}</span><br>
                                <small class="fw-bold">{{ intervention.datePlanifiee|date('H:i') }}</small>
                            </td>
                            <td class="py-4 px-3">
                                <span class="badge" style="padding: 12px 18px; border-radius: 10px; font-size: 1rem; 
                                    {% if intervention.statut == 'En attente' %} background-color: #fff4e5; color: #ff8c00;
                                    {% elseif intervention.statut == 'Effectu√©e' %} background-color: #e5f9f0; color: #27ae60;
                                    {% else %} background-color: #f1f3f5; color: #6c757d; {% endif %}">
                                    {{ intervention.statut }}
                                </span>
                            </td>
                            <td class="py-4 px-3">
                                {% if intervention.medecin %}
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-user-md me-2 text-primary"></i>
                                        <span>{{ intervention.medecin.prenom }} {{ intervention.medecin.nom }}</span>
                                    </div>
                                {% else %}
                                    <span class="text-muted" style="font-style: italic; font-size: 0.9rem;">Non assign√©e</span>
                                {% endif %}
                            </td>
                            <td class="py-4 px-3 text-center">
                                <div class="d-flex justify-content-center gap-3">
                                    <a href="{{ path('app_intervention_show', {'id': intervention.id}) }}" 
                                       class="btn shadow-sm text-white" 
                                       style="background: linear-gradient(to right, #516be1, #7b91ff); border-radius: 10px; padding: 10px 25px; font-weight: 500; border: none;">
                                        üëÅÔ∏è Voir
                                    </a>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="text-center py-5 shadow-sm mt-4" style="background: #fdfdfd; border-radius: 15px;">
            <i class="fas fa-search fa-3x text-muted mb-3"></i>
            <p class="text-muted" style="font-size: 1.3rem;">Aucune intervention ne correspond √† votre recherche.</p>
        </div>
    {% endif %}
</div>

<style>
    tbody tr:hover {
        background-color: #fcfcfc !important;
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0,0,0,0.02);
    }
    .table thead th {
        letter-spacing: 0.5px;
        text-transform: uppercase;
        font-size: 0.9rem;
    }
</style>
{% endblock %}